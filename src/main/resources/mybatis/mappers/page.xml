<!DOCTYPE mapper
       PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.PageDAO">

    <sql id="criteria">
        <if test='type =="M"'>
            where maker like concat('%',#{keyword}, '%')
        </if>
        <if test='type =="N"'>
            where model_name like concat('%',#{keyword}, '%')
        </if>
        <if test='type =="D"'>
            where recall_date like concat('%',#{keyword}, '%')
        </if>
        <if test='type =="MN"'>
            where maker like concat('%',#{keyword}, '%') or model_name like concat('%',#{keyword}, '%')
        </if>
        <if test='type =="MD"'>
            where maker like concat('%',#{keyword}, '%') or recall_date like concat('%',#{keyword}, '%')
        </if>
        <if test='type =="MND"'>
            where maker like concat('%',#{keyword}, '%') or model_name like concat('%',#{keyword}, '%') or recall_date like concat('%',#{keyword}, '%')
        </if>
    </sql>


    <!-- <![CDATA[]]> : mybatis 에서 특수문자 인식 처리 -->
    <select id="listWithPaging" resultType="com.boot.dto.RecallDTO">
        <![CDATA[
            SELECT id, maker, model_name, make_start, make_end, recall_date, recall_reason
                FROM (
                    SELECT rownum AS rn, id, maker, model_name, make_start, make_end, recall_date, recall_reason
                        FROM (
                            SELECT id, maker, model_name, make_start, make_end, recall_date, recall_reason
                        FROM recall
        ]]>
            <include refid="criteria"/>
        <![CDATA[
            ORDER BY id DESC
            )
            WHERE rownum <= (#{pageNum} * #{amount})
        )
        WHERE rn > (#{pageNum}-1) * #{amount}
        ]]>
    </select>
    <select id="getTotalCount" resultType="int">
        select count(*) from recall
        <include refid="criteria"></include>
    </select>

</mapper>